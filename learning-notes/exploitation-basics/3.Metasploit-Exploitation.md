# 1. Scanning
## 1.1 Port Scanning
- `search portscan`: list potential port scanning modules available.
- Port scanning module cần set vài option:
	+ **CONCURRENCY**: số lượng mục tiêu đc scan đồng thời.
	+ **PORTS**: Dải port đc scan. Ví dụ 1-1000 sẽ scan từ port 1 tới port 1000. Còn Nmap là scan 1000 port thường dùng nhất.
	+ **RHOSTS**: target hoặc target network đc scan
	+ **THREADS**: số lượng thread sẽ được dùng đồng thời. Nhiều threads -> scan nhanh hơn.
- Có thể trực tiếp quét bằng Nmap trong Metasploit: `nmap -sS 10.10.29.229`

## 1.2 UDP service Identification
- `scanner/discovery/udp_sweep` module cho phép bạn nhanh chóng xác định các dịch vụ chạy qua UDP. 

## 1.3 SMB Scans
- Metasploit có 1 số auxilirary module cho phép scan dvu cụ thể: `smb_enumshares` và `smb_version`.
- Khi thực hiện quét, k bỏ qua các service kì lạ như NetBIOS, giống MSB cho phép computer giao tiếp qua network để share files hoặc send file tới máy in. 

# 2. The Metasploit Database
- Khi có 1 vài target thì cần data để lưu trữ cái gtri parameter đã set up.
- `systemctl start postgresql`: start  PostgreSQL database.
- `msfdb init`: khởi tạo  Metasploit Database.
- Có thể launch `msfconsole` và check lại bằng `db_status`.
- Database cho phép tạo các workspace cho từng project khác nhau. `workspace` list available workspaces.
- `workspace -a [name]`: tạo mới workspace
- `workspace -d [name]`: xóa workspace
- `workspace [name]`: điều hướng, đi tới workspace, đang ở workspace nào thì workspace đó sẽ bắt đầu bằng `*`.
- `workspace -h`: list available options for workspace.
- một khi metasploit đc khởi chạy cùng database, lệnh `help` sẽ in ra Database Backends Commands menu.
- Nếu chạy Nmap scan dùng `db_nmap`, toàn bộ kết quả sẽ lưu trong database. 
- `hosts` và `services`: tiếp cận các thông tin lqan đến hosts và services chạy trên target systems. Thêm `-h` để xem options có sẵn.
- Khi thông tin đc lưu trong database, `host -R` để thêm gtri RHOST.

- **Example Workflow**
	1. We will use the vulnerability scanning module that finds potential MS17-010 vulnerabilities with the use `auxiliary/scanner/smb/smb_ms17_010` command.
	2. We set the RHOSTS value using `hosts -R`.
	3. We have typed show options to check if all values were assigned correctly. (In this example, 10.10.138.32 is the IP address we have scanned earlier using the db_nmap command)
	4. Once all parameters are set, we launch the exploit using the run or exploit command. 

- Nếu có nhiều hơn 1 host đc lưu vào database, tất cả đchi IP sẽ đc dùng khi có lệnh `hosts -R`.
- `services -S [service's name]`: tìm các services trong environment.

# 3. Vulnerability Scanning
- Metasploit cho phép nhận diện nhanh các lỗ hỏng quan trọng đc đánh giá là "low hanging fruit". 
- Finding vulnerabilities phụ thuộc nhiều vào khả năng scan và fingerprint the target. Ví dụ muốn nhận diện một VNC service đang chạy trên target, dùng `search` để list các useful module.
- `info`: xem thêm và cách sử dụng và mục đích của module.

# 4. Exploitation
- `search`: search exploits
- `info`: obtain more information
- `exploit`: launch the exploit.
- `show payloads`:  list other commands you can use with that specific exploit.
- `set payload`: quyết định payload. Choosing workign a payload, có thể là quá trình thử và sai vì environmental hoặc hạn chế của OS (firewall, anti-virus...). Một vài payload sẽ cần set thêm parameter, `show options` để xem thêm.
- `CTRL + Z`: chạy background session; `CTRL + C`: hủy session.

## 4.1 Working with sessions
- `sessions`: list các active sessions. Mỗi session có id để quản lý.
- `sessions -i [number]`: làm việc vs session có id.

# 5. Msfvenom
- Msfvenom cho phép truy cập vào tất cả payloads trong Metasploit payloads. Cho phép tạo payloads ở nhiều format khác nhau (PHP, exe,...) và cho nhiều target system (Apple, Window)...
- `msfvenom -l payloads`: listing payloads available.
